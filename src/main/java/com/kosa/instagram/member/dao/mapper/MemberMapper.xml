<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kosa.instagram.member.dao.IMemberRepository">

<insert id="insertMember" parameterType="com.kosa.instagram.member.model.MemberVo">

INSERT INTO MEMBER 
	(MEMBER_ID, PASSWORD, NICKNAME, NAME, GENDER, EMAIL, BIRTH, PHONE_NUMBER)
VALUES
	(#{memberId}, #{password}, #{nickname}, #{name}, #{gender}, #{email}, #{birth}, #{phoneNumber}) 
</insert>

<select id="selectMember" resultType="com.kosa.instagram.member.model.MemberVo" parameterType="String">
	SELECT  
		M.MEMBER_ID  	AS  "memberId", 
		M.PASSWORD 		AS  "password", 
		M.NICKNAME		AS  "nickname", 
		M.NAME			AS  "name", 
		M.GENDER		AS	"gender",
		M.EMAIL			AS	"email", 
		M.BIRTH			AS	"birth", 
		M.PHONE_NUMBER 	AS "phoneNumber",
        F.FILE_NO 	AS "fileNo"
	FROM MEMBER M LEFT JOIN UPLOAD_FILE F
    ON M.MEMBER_ID = F.MEMBER_ID
	WHERE M.MEMBER_ID = #{memberId} and F.FEED_NO IS NULL
</select>

<insert id="insertFile" parameterType="com.kosa.instagram.feed.model.FileVo">
	INSERT INTO UPLOAD_FILE
			(FILE_NO, FILE_DATA, FILE_NAME, FILE_SIZE, FILE_TYPE, MEMBER_ID)
	VALUES 
			(FILE_NO_SEQ.NEXTVAL, #{fileData}, #{fileName}, #{fileSize}, #{fileType}, #{memberId})
</insert>

<update id="updateFile" parameterType="com.kosa.instagram.feed.model.FileVo">
	UPDATE UPLOAD_FILE
	SET FILE_DATA=#{fileData}, FILE_NAME=#{fileName}, FILE_SIZE=#{fileSize}, FILE_TYPE=#{fileType}
	WHERE MEMBER_ID = #{memberId}
</update>

<update id="updateMember" parameterType="com.kosa.instagram.member.model.MemberVo">
	UPDATE MEMBER
	SET PASSWORD=#{password}, NICKNAME=#{nickname}, PHONE_NUMBER=#{phoneNumber}
	WHERE MEMBER_ID=#{memberId} 
</update>

<select id="selectFileNo" parameterType="String" resultType="integer">
	select file_no as "fileNo"
	from upload_file 
	where member_id =#{memberId} and feed_no is null
</select>

<delete id="deleteMember" parameterType="com.kosa.instagram.member.model.MemberVo">
	DELETE FROM MEMBER
	WHERE MEMBER_ID = #{memberId} AND PASSWORD = #{password} 
</delete>

<select id="getPassword" parameterType="String" resultType="String">
	SELECT PASSWORD
	FROM MEMBER
	WHERE MEMBER_ID = #{memberId}
</select>

</mapper>